#!/usr/bin/env bash

# Mackup Configuration Restore
# Restores application settings and configurations from cloud storage

set -euo pipefail

# Check if mackup is installed
if ! command -v mackup >/dev/null 2>&1; then
    echo "âš ï¸  Mackup not installed. Installing via Homebrew..."
    if command -v brew >/dev/null 2>&1; then
        brew install mackup
    else
        echo "âŒ Homebrew not available. Skipping mackup setup."
        exit 0
    fi
fi

# Check if mackup configuration exists
if [[ ! -f "$HOME/.mackup.cfg" ]]; then
    echo "ðŸ“‹ Creating basic mackup configuration..."
    cat >"$HOME/.mackup.cfg" <<'EOF'
[storage]
engine = icloud

[applications_to_ignore]
# Add applications you don't want to sync
# ssh
EOF
    echo "âœ… Created ~/.mackup.cfg"
    echo "ðŸ’¡ Edit ~/.mackup.cfg to customize sync settings"
fi

# Ask user if they want to restore
echo "ðŸ”„ Mackup can restore application settings from cloud storage"
echo "âš ï¸  This will overwrite existing application configurations"
read -p "Do you want to restore configurations? [y/N]: " restore_choice

if [[ "$restore_choice" =~ ^[Yy]$ ]]; then
    echo "ðŸ”„ Restoring configurations with mackup..."
    if mackup restore; then
        echo "âœ… Mackup restore completed successfully"
    else
        echo "âŒ Mackup restore failed"
        exit 1
    fi
else
    echo "â­ï¸  Skipped mackup restore"
    echo "ðŸ’¡ You can run 'mackup restore' manually later"
fi
